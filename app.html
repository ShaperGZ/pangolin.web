<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css"href="ArchProto.css">
    <style>
        .label{
                    color: #FFF;
                    font-family: sans-serif;
                    padding: 2px;
                    background: rgba( 0, 0, 0, .6 );
                }
    </style>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
</head>
<script src="three.min.js"></script>
<script src="controls/TrackballControls.js"></script>
<script src="controls/DragControls.js"></script>
<script src="controls/OrbitControls.js"></script>
<script src="controls/SelectionControls.js"></script>
<script src="controls/TransformControls.js"></script>
<script src="./interpretor.js"></script>
<script src="object_manager.js"></script>
<script src="threejsViewer.js"></script>
<script src="widgets/transform.js"></script>
<script src="utilities.js"></script>
<script src="materials.js"></script>
<script src="tests/test_geometries.js"></script>

<script src="libs/dat.gui/dat.gui.min.js"></script>
<script src="libs/postprocessing/EffectComposer.js"></script>
<script src="libs/postprocessing/RenderPass.js"></script>
<script src="libs/postprocessing/SAOPass.js"></script>
<script src="libs/postprocessing/ShaderPass.js"></script>
<script src="libs/shaders/CopyShader.js"></script>
<script src="libs/shaders/SAOShader.js"></script>
<script src="libs/shaders/DepthLimitedBlurShader.js"></script>
<script src="libs/shaders/UnpackDepthRGBAShader.js"></script>
<script src="libs/renderers/CSS2DRenderer.js"></script>
<script src="libs/labels.js"></script>
<script src='libs/lines/LineSegmentsGeometry.js'></script>
<script src='libs/lines/LineGeometry.js'></script>
<script src='libs/lines/WireframeGeometry2.js'></script>
<script src='libs/lines/LineMaterial.js'></script>
<script src='libs/lines/LineSegments2.js'></script>
<script src='libs/lines/Line2.js'></script>
<script src='libs/lines/Wireframe.js'></script>

<!-- libraries -->
<script src='library.js'></script>
<script src='texture_library.js'></script>
<script src='geometry_library.js'></script>
<script src='component_library.js'></script>

<!--百度地图-->
<!--加载基础地图component-->
<!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=sKy1jTEskG3XbRwiPRgoAedpp9Ko9l6Q"></script>-->
<!--加载鼠标绘制工具-->
<!--<script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>-->
<!--<script src='baidu_component/map.js'></script>-->

<!--<link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />-->
<!--<script src="map_update.js"></script>-->
<!--<script src="map_data.js"></script>-->

<script src="hud.js"></script>
<script src="gui_manager.js"></script>
<link rel="stylesheet" href="w3.css">
<link rel="stylesheet" href="w3-color-flat.css">
<link rel="stylesheet" href="main.css">

<body>

<div id='side_bar' style="display:none" class="w3-sidebar w3-bar-block w3-card w3-animate-left content">
    <button onclick="close_sidebar()" class="w3-bar-item w3-button w3-blue">Close &times;</button>
    <p> this is a side bar</p>
    <a href="#" class='fullWidth w3-button'>Link 1</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <a href="#" class='fullWidth w3-button'>Link 2</a>
    <div class='fullWidth w3-button content'>
        <span >title</span><input type='input' value =123 ></div>
    </div>
   
</div>


<div id = 'scene'>
    <div>
        <button id="open_sidebar" onclick="open_sidebar()" class="w3-button w3-blue w3-xlarge float" >&#9776;</button>
    </div>
    <div id='command_line' class="overlayMessagePanel content"
         style="width:250px; height:20px; margin-left:60px ; margin-top: 5px">
        <input id='txt_command_line' type="text" value="s" style="width: 250px; background-color: black; border-style: none; color: #ffc107;">
    </div>
    <div id='reloader' class="overlayMessagePanel content"
         style="width:250px; height:20px; margin-left:60px ; margin-top: 25px">
        <input id='bt_reloader' type="button" value="RELOAD" style="width: 80px;border-style: none;">
        <input id='txt_reloader' type="text" value="modulename" style="width: 166px;border-style: none;">
    </div>
    <div id='js_hud_states' class="overlayMessagePanel content"
         style="width:250px; font-size: 12px; height:20px; margin-left:60px ; margin-top: 45px">
        <div id='js_hud_states_sr' style="width:30px; height:15px; display: inline; background-color: orange"> 選組(I) </div>
        <div id='js_hud_states_mv' style="width:30px; height:15px; display: inline; margin-left: 5px; background-color: grey"> MV </div>
        <div id='js_hud_states_rt' style="width:30px; height:15px; display: inline; margin-left: 5px; background-color: grey"> RT </div>
        <div id='js_hud_states_sc' style="width:30px; height:15px; display: inline; margin-left: 5px; background-color: grey"> SC </div>
        <div id='open_component_browser' style="width:30px; height:15px; display: inline; margin-left: 5px; background-color: cornflowerblue"> COMPONENTS </div>
    </div>

    <div id='hud01' class="overlayMessagePanel content"
            style="width:250px; height:200px; margin-left:60px; margin-top: 65px">
            <div id="hud01_content">server generated contents ... </div>
    </div>
    <div id="component_browser" class="overlayMessagePanel content"
               style="width:250px; background-color: grey; font-size:16px ; color:white; height:400px; margin-left:60px; margin-top: 65px">
    <div>item 1 </div>
</div>

    <div id="threejs_container" style="height: 100%, top:0px" ></div>
</div>
<div id="map_container" class="overlayMessagePanel content"
     style="width:100%; height:100%; margin-left:0px"
>Map Selector</div>
            

    
</body>

<script>
    // var map = new BaiduMap('map_container')
    function set_command_line(){
        dom = document.getElementById('txt_command_line')
        dom.onkeydown = function(e){
            if(e.keyCode == 13){
                msg = dom.value
                socket.send(msg)
                dom.value=''
            }
        }

    }
    set_command_line()

    function load_component_list(browser){
        browser.innerHTML = ''

        function assign_item_on_click(div, id){
            div.addEventListener('mouseup', function(){
                console.log('inspecting:',id)
                viewer.inspect_object(id);
            }, false);
        }

        var lib = viewer.component_lib
        for(var key in lib.objects){
            div = document.createElement('div')
            div.style.cursor = 'pointer'
            div.innerHTML = lib.objects[key].ref_key
            browser.appendChild(div)
            assign_item_on_click(div, key)
        }


    }

    function set_component_browser(){
        var operant = document.getElementById('open_component_browser')
        var browser = document.getElementById('component_browser')
        browser.style.display = 'none';
        operant.style.cursor = 'pointer'

        function component_browser_operant_onclick(){
            console.log('mouse up')
            if (browser.style.display == 'none'){
                browser.style.display = 'block'
                load_component_list(browser)
            }
            else{
                browser.style.display = 'none';
            }
        }

        operant.addEventListener('mouseup', component_browser_operant_onclick, false)



    }
    set_component_browser()

    function openMap(){
        map.show()
        document.getElementById('scene').style.display='none'
    }
    function closeMap(){
        map.hide()
        document.getElementById('scene').style.display='block'
    }

    function open_sidebar(){
        //document.getElementById("threejs_container").style.marginLeft = "300px";
        document.getElementById("side_bar").style.width = "200px";
        document.getElementById("side_bar").style.display = "block";
        document.getElementById("open_sidebar").style.display = 'none';
        document.getElementById("overlay_div").style.marginLeft = '210px'
        this.onWindowResize()
        
    }
    function close_sidebar(){
        document.getElementById("threejs_container").style.marginLeft = "0%";
        document.getElementById("side_bar").style.display = "none";
        document.getElementById("open_sidebar").style.display = "inline-block";
        document.getElementById("overlay_div").style.marginLeft = '60px'
        this.onWindowResize()
    }

    //create 3d viewer
    var viewer=new Viewer();
    viewer.init();
    viewer.animate();

    // create object3d manager
    // and set the scene to be managed
    // the manager creates, edits and removes object3d from the scene
    var manager=viewer.manager
    
    
    // create interpretor
    // and set the manager, so that the parsed\
    // command directly calls methods from manager
    var inter=new Interpretor(viewer,manager);

    //create socketio and handling functions
    handle_connect=function(data){
        console.log('connected');
        viewer.clear_scene()
        socket.send('scene.load_scene()')
        }

    handle_message=function(data){
        // console.log('recieved:'+data)
        // console.log(typeof(data))
        if(data.includes('[') && data.includes('{')){
            inter.parse_multiple(data)
        }
        
    }


    socket = io('http://localhost:5567/',false)
    socket.on('connect',handle_connect)
    socket.on('message',handle_message)
    // socket.send('hello server')

    function python(script){
        var data = {'cmd':'eval','script':script}
        var message = JSON.stringify(data)
        socket.send(message)
    }

    set_gui = function(parameters){
        var id = parameters['root']['id']
        // console.log('scene.set_gui', id,parameters)
        viewer.datgui.set_inspector(parameters, id)
        viewer.transformWidget.create(parameters['root'].value['Transform'].value, id)
    }




    //
    // flag1 = makeFlagLabel()
    // viewer.scene.add(flag1)
    // setFlagLabel(flag1,' ♣ Lets try a long phrase with special characters! ',50,10)
    //
    // flag2 = makeFlagLabel()
    // viewer.scene.add(flag2)
    // setFlagLabel(flag2,'中文字體，占用雙倍寬度',80,20,{backgroundColor:{r:1,g:0,b:0,a:1}, isChinese:true, fontsize:60})
    // flag2.position.set(15,0,3)
    //
    //
    // flag3 = makeFlagLabel()
    // viewer.scene.add(flag3)
    // setFlagLabel(flag3,'藍色 30號 半徑為0',60,0,{backgroundColor:{r:0.3,g:0.3,b:1,a:1}, isChinese:true, fontsize:30})
    // flag3.position.set(8,0,18)

    viewer.update_camera([-150,-130,145])

</script>
</html>