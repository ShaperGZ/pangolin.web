<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css"href="ArchProto.css">
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
</head>
<script src="three.min.js"></script>
<script src="controls/TrackballControls.js"></script>
<script src="controls/DragControls.js"></script>
<script src="controls/OrbitControls.js"></script>
<script src="controls/SelectionControls.js"></script>
<script src="./interpretor.js"></script>
<script src="object_manager.js"></script>
<script src="threejsViewer.js"></script>
<script src="utilities.js"></script>
<script src="materials.js"></script>
<script src="tests/test_geometries.js"></script>
<script src="libs/dat.gui/dat.gui.min.js"></script>
<script src="libs/labels.js"></script>
<script src="hud.js"></script>
<script src="gui_manager.js"></script>

<body>
    <div id="threejs_container" style="width: 100%; height: 100%;">
        <!--<input id='slider_u' type='range' min='5' max='50' step='1' value='10'>-->
        <!--<input id='slider_v' type='range' min='5' max='50' step='1' value='10'>-->
        <!--<input id='slider_w' type='range' min='1' max='20' step='1' value='10'>-->
    
    </div>
</body>

<script>
    //create 3d viewer
    
    var viewer=new Viewer();
    viewer.init();
    viewer.animate();

    // create object3d manager
    // and set the scene to be managed
    // the manager creates, edits and removes object3d from the scene
    var manager=viewer.manager
    
    
    // create interpretor
    // and set the manager, so that the parsed\
    // command directly calls methods from manager
    var inter=new Interpretor(viewer,manager);

    //create socketio and handling functions
    handle_connect=function(data){
        console.log('connected');
        socket.send('update_all()')
        }

    handle_message=function(data){
        console.log('recieved:'+data)
        console.log(typeof(data))
        if(data.includes('[') && data.includes('{')){
            inter.parse_multiple(data)
        }
        
    }


    socket=io('http://localhost:5567/',false)
    socket.on('connect',handle_connect)
    socket.on('message',handle_message)
    socket.send('hello server')


    
    //message = JSON.stringify(datas)
    //var ids=inter.parse_multiple(message)
    //console.log(ids[0])
    //var objects=[manager.mapper[ids[0]]]
    //var dragControls = new THREE.DragControls( objects, viewer.camera, viewer.renderer.domElement );
    //dragControls.addEventListener( 'dragstart', function () {
    //    viewer.controls.enabled = false;
    //
    //} );
    //dragControls.addEventListener( 'dragend', function () {

      //  viewer.controls.enabled = true;

    //} );

    //console.log(ids[0])


    function python(script){
        var data = {'cmd':'eval','script':script}
        var message = JSON.stringify(data)
        socket.send(message)
    }

    

//    var variables={'u':10,'v':10}
//    function assign_slider_handlers(slider_id){
//        var slider = document.getElementById(slider_id);
//        slider.onchange = function(){
//            var value = slider.value;
//            key = slider_id.split('_')[1]
//            variables[key]= value
//            var u,v
//            u = variables['u']
//            v = variables['v']
//            //test_line_group(manager,u,v)
//            //test_point_clouds(manager,u*2,v*2,0.5)
//            test_mesh(manager,u*2,v*2,0.5)
//        }
//
//        slider.ondrag = function(){
//            console.log(slider.value)
//        }
//    }




//    function assign_slider_handler_set_count_d(slider_id){
//        var slider = document.getElementById(slider_id);
//        slider.onchange = function(){
//            var value = slider.value;
//            msg = 'set_d('+value+')'
//            socket.send(msg)
//        }
//
//        slider.ondrag = function(){
//            console.log(slider.value)
//        }
//    }
//    assign_slider_handlers('slider_u')
//    assign_slider_handlers('slider_v')
//    assign_slider_handler_set_count_d('slider_w')
    //test_lines(manager)
    //test_line_group(manager,10,10)
    //test_point_clouds(manager,20,10,0.8)
    //meshid = test_mesh(manager,10,10)
    //poygon_mesh = test_polygon_mesh(manager)



    set_gui = function(id, parameters){
        viewer.datgui.set_inspector(id,parameters)
//        console.log('set_gui')
//        //clear the gui
//        for(var i=0;i<gui_controls.length;i++){
//            gui.remove(gui_controls[i])
//        }
//
//        gui_obj={}
//        gui_obj_domain={}
//        for(var k  in parameters){
//            var value = parameters[k].value
//            var lower = Math.round(value/4)
//            var higher = value*4
//            if(parameters[k].type=='integer')
//                step=1
//            else
//                step=1
//                //step = value/10.0
//            gui_obj[k] = value
//            gui_obj_domain[k] = [higher,lower,step]
//        }
//        for(var k in gui_obj){
//            var max = gui_obj_domain[k][0]
//            var min = gui_obj_domain[k][1]
//            var step = gui_obj_domain[k][2]
//            if (min<1) min =1
//            var control = gui.add(gui_obj,k, min, max)
//
//            control.step(1)
//            gui_controls.push(control)
//
//            function assign_onchange(id,k,control){
//                control.onChange(function(){
//                    var value = gui_obj[k]
//                    var msg = 'set_state_value("'+id+'","'+k+'",'+value+')'
//                    console.log(msg)
//                    socket.send(msg)
//                })
//            }
//            assign_onchange(id,k,control)
//

    }


    sp = makeTextSprite('asdasd');
    viewer.scene.add(sp);
    sp.position.set(10,0,0);



</script>
</html>